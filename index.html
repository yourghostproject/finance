<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YGP Finance — Simple</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    html,body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .card{ @apply bg-white/80 dark:bg-slate-900/70 backdrop-blur rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm; }
    .input{ @apply w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm; }
    .btn{ @apply inline-flex items-center justify-center px-3.5 py-2.5 rounded-xl text-sm font-medium border border-slate-300 dark:border-slate-700 bg-slate-50 hover:bg-slate-100 dark:bg-slate-800 dark:hover:bg-slate-700; }
    .btn-primary{ @apply bg-slate-900 text-white border-slate-900 hover:bg-black; }
    .pill-ok{ @apply text-emerald-700 bg-emerald-100 px-2 py-0.5 rounded-full text-xs; }
    .pill-alert{ @apply text-rose-700 bg-rose-100 px-2 py-0.5 rounded-full text-xs; }
    .table{ @apply w-full text-sm; }
    .table th{ @apply text-left font-semibold text-slate-500; }
    .table td,.table th{ @apply px-3 py-2; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900 text-slate-800 dark:text-slate-100">
  <div class="max-w-4xl mx-auto px-4 py-8 space-y-6">

    <header class="flex items-center justify-between">
      <h1 class="text-xl font-bold">YGP Finance — version simple</h1>
      <div class="flex gap-2">
        <button id="btnSeed" class="btn">Ajouter revenus d'octobre</button>
        <button id="btnReset" class="btn">Réinitialiser</button>
      </div>
    </header>

    <!-- 1) Réglages essentiels -->
    <section class="card p-4">
      <h2 class="text-base font-semibold mb-3">Réglages</h2>
      <div class="grid sm:grid-cols-2 gap-3">
        <label class="text-sm">Start (AAAA-MM)
          <input id="startMonth" class="input" value="2025-10" />
        </label>
        <label class="text-sm">Mois à prévoir
          <input id="months" type="number" class="input" value="6" />
        </label>
        <label class="text-sm">Épargne de départ (£)
          <input id="starting" type="number" class="input" value="25749" />
        </label>
        <label class="text-sm">Coût de vie mensuel (£)
          <input id="living" type="number" class="input" value="2500" />
        </label>
        <label class="text-sm">Plancher sécurité (£)
          <input id="floor" type="number" class="input" value="20000" />
        </label>
        <label class="text-sm">Tax pot musique (ex: 0.25)
          <input id="taxRate" type="number" step="0.01" class="input" value="0.25" />
        </label>
      </div>
    </section>

    <!-- 2) Saisie ultra simple des revenus -->
    <section class="card p-4">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-base font-semibold">Entrées (revenus)</h2>
        <button id="btnAddRow" class="btn btn-primary">Ajouter une ligne</button>
      </div>
      <div class="overflow-x-auto">
        <table class="table" id="incomeTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Mois</th>
              <th>Type</th>
              <th>Source</th>
              <th>Montant (£)</th>
              <th>Tax pot</th>
              <th>Net</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="incomeBody"></tbody>
        </table>
      </div>
      <p class="text-xs text-slate-500 mt-2">Utilise <b>Type = Music</b> pour appliquer la réserve (tax pot).</p>
    </section>

    <!-- 3) Prévision claire -->
    <section class="card p-4">
      <h2 class="text-base font-semibold mb-3">Prévision (mensuelle)</h2>
      <div class="overflow-x-auto">
        <table class="table" id="forecastTable">
          <thead>
            <tr>
              <th>Mois</th>
              <th>Ouverture</th>
              <th>Entrées (hors musique)</th>
              <th>Musique (net)</th>
              <th>Coût de vie</th>
              <th>Variation</th>
              <th>Clôture</th>
              <th>Statut</th>
            </tr>
          </thead>
          <tbody id="forecastBody"></tbody>
        </table>
      </div>
    </section>

  </div>

<script>
const STORAGE='ygp_finance_simple_v1';
let state = JSON.parse(localStorage.getItem(STORAGE)||'{}');
if(!state.settings){ state={settings:{startMonth:'2025-10',months:6,starting:25749,living:2500,floor:20000,taxRate:0.25}, incomes:[]}; }

const el={
  startMonth:document.getElementById('startMonth'),
  months:document.getElementById('months'),
  starting:document.getElementById('starting'),
  living:document.getElementById('living'),
  floor:document.getElementById('floor'),
  taxRate:document.getElementById('taxRate'),
  incomeBody:document.getElementById('incomeBody'),
  forecastBody:document.getElementById('forecastBody'),
  btnAddRow:document.getElementById('btnAddRow'),
  btnSeed:document.getElementById('btnSeed'),
  btnReset:document.getElementById('btnReset')
};

function save(){ localStorage.setItem(STORAGE, JSON.stringify(state)); }
function monthsFrom(start, n){ const [Y,M]=start.split('-').map(Number); const d=new Date(Y,M-1,1); const out=[]; for(let i=0;i<n;i++){ out.push(`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`); d.setMonth(d.getMonth()+1); } return out; }

function renderSettings(){ const s=state.settings; el.startMonth.value=s.startMonth; el.months.value=s.months; el.starting.value=s.starting; el.living.value=s.living; el.floor.value=s.floor; el.taxRate.value=s.taxRate; }
function readSettings(){ const s=state.settings; s.startMonth=el.startMonth.value.trim(); s.months=parseInt(el.months.value||6,10); s.starting=parseFloat(el.starting.value||0); s.living=parseFloat(el.living.value||0); s.floor=parseFloat(el.floor.value||0); s.taxRate=parseFloat(el.taxRate.value||0.25); save(); render(); }

function addRow(row){ state.incomes.push(row||{date:'',month:'',type:'Other',source:'',gross:0}); save(); renderIncome(); renderForecast(); }
function delRow(i){ state.incomes.splice(i,1); save(); render(); }

function renderIncome(){ el.incomeBody.innerHTML=''; state.incomes.forEach((r,i)=>{ const isMusic=(r.type==='Music'); const tax=isMusic? (r.gross||0)*state.settings.taxRate:0; const net=(r.gross||0)-tax; const tr=document.createElement('tr'); tr.innerHTML=`
  <td><input class="input" value="${r.date||''}" data-i="${i}" data-k="date" placeholder="AAAA-MM-JJ"></td>
  <td><input class="input" value="${r.month||''}" data-i="${i}" data-k="month" placeholder="AAAA-MM"></td>
  <td>
    <select class="input" data-i="${i}" data-k="type">
      <option ${r.type==='Music'?'selected':''}>Music</option>
      <option ${r.type==='Salary'?'selected':''}>Salary</option>
      <option ${r.type==='Other'?'selected':''}>Other</option>
    </select>
  </td>
  <td><input class="input" value="${r.source||''}" data-i="${i}" data-k="source" placeholder="Source"></td>
  <td><input class="input" type="number" value="${r.gross||0}" data-i="${i}" data-k="gross"></td>
  <td>£${tax.toLocaleString()}</td>
  <td>£${net.toLocaleString()}</td>
  <td><button class="btn" data-del="${i}">Suppr</button></td>`; el.incomeBody.appendChild(tr); }); }

el.incomeBody.addEventListener('input', (e)=>{ const t=e.target; const i=+t.getAttribute('data-i'); const k=t.getAttribute('data-k'); if(Number.isInteger(i) && k){ let v=t.value; if(k==='gross') v=parseFloat(v||0); state.incomes[i][k]=v; save(); render(); }});
el.incomeBody.addEventListener('click', (e)=>{ const b=e.target.closest('button[data-del]'); if(b){ delRow(+b.getAttribute('data-del')); }});

function sum(arr, fn){ return arr.reduce((a,b)=>a+(fn(b)||0),0); }
function renderForecast(){ const s=state.settings; const months=monthsFrom(s.startMonth,s.months); let opening=s.starting; el.forecastBody.innerHTML=''; months.forEach(m=>{ const rows=state.incomes.filter(r=>r.month===m); const nonMusic=sum(rows,r=> r.type!=='Music'? +r.gross:0); const musicNet=sum(rows,r=> r.type==='Music'? (+r.gross - (+r.gross*s.taxRate)):0 ); const inflows=nonMusic+musicNet; const change=inflows - s.living; const closing=opening + change; const ok=closing>=s.floor; const tr=document.createElement('tr'); tr.innerHTML=`
  <td>${m}</td>
  <td>£${opening.toLocaleString()}</td>
  <td>£${nonMusic.toLocaleString()}</td>
  <td>£${musicNet.toLocaleString()}</td>
  <td>£${s.living.toLocaleString()}</td>
  <td class="${change<0?'text-rose-600':''}">£${change.toLocaleString()}</td>
  <td class="${ok?'':'text-rose-600 font-semibold'}">£${closing.toLocaleString()}</td>
  <td><span class="${ok?'pill-ok':'pill-alert'}">${ok?'OK':'< £20k'}</span></td>`; el.forecastBody.appendChild(tr); opening=closing; }); }

function render(){ renderSettings(); renderIncome(); renderForecast(); }

// Buttons
el.btnAddRow.addEventListener('click',()=> addRow());
el.btnSeed.addEventListener('click',()=>{ addRow({date:'2025-10-01',month:'2025-10',type:'Other',source:'Flat deposit refund',gross:1000}); addRow({date:'2025-10-01',month:'2025-10',type:'Salary',source:'Final PAYE salary',gross:3300}); });
el.btnReset.addEventListener('click',()=>{ if(confirm('Tout réinitialiser ?')){ state={settings:{startMonth:'2025-10',months:6,starting:25749,living:2500,floor:20000,taxRate:0.25}, incomes:[]}; save(); render(); }});

// Settings change listeners
['startMonth','months','starting','living','floor','taxRate'].forEach(id=>{ document.getElementById(id).addEventListener('change', readSettings); });

render();
</script>
</body>
</html>
